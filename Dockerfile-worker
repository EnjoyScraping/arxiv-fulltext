# arxiv/fulltext-worker

FROM arxiv/base:0.15.6

WORKDIR /opt/arxiv

# MySQL is needed for the arxiv-auth package.
RUN yum install -y which mysql mysql-devel

RUN curl https://get.docker.com/ > getdocker.sh
RUN /bin/sh getdocker.sh

# Add Python consumer and configuration.
RUN pip install -U pip pipenv uwsgi
ADD Pipfile /opt/arxiv/
RUN pipenv install

VOLUME /data

ENV PATH "/opt/arxiv:${PATH}"

ENV LC_ALL en_US.utf8
ENV LANG en_US.utf8
ENV LOGLEVEL 10

ENV ARXIV_HOME "https://arxiv.org"
ENV STORAGE_VOLUME /data

ADD fulltext /opt/arxiv/fulltext/

VOLUME /pdfs
VOLUME /data

ENV WORKDIR /pdfs

ENTRYPOINT ["pipenv", "run"]
CMD ["celery", "worker", "-A", "fulltext.worker.celery_app", "--loglevel=INFO", "-E", "--concurrency=1"]
